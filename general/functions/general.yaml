functions:
  reverse_general_match_ip_to_subnet:
    title: Принадлежность адреса к сети
    params:
      - alias: cidr
        type: string
        title: CIDR сети
        required: true  # Признак обязательности параметра функции
      - alias: ip
        type: string
        title: IP Адрес
        required: false  # Признак обязательности параметра функции
    code: >
      (
          $matchip := function($cidr, $ip) {(
                                $mask := $split($cidr, '/')[1];
                                $subaddr := $split($cidr, '/')[0];
                                $suboctets := $split($subaddr,'.');
                                $ipoctets := $split($ip, '.');
                                $subnstring := $substring(
                                    $join($suboctets.$formatBase($number($), 2).(
                                        $tmp := $;
                                        $join([$length($)..7].('0')) & $tmp
                                        )
                                    ), 0, $number($mask)
                                );
                                $ipstring := $substring(
                                    $join($ipoctets.$formatBase($number($), 2).(
                                        $tmp := $;
                                        $join([$length($)..7].('0')) & $tmp
                                        )
                                    ), 0, $number($mask)
                                );
                                $ipstring = $subnstring ? true : false
                      )};
          $matchip(cidr, ip)
      )
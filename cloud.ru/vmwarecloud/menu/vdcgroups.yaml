entities:
  seaf.ta.reverse.vmwarecloud.vdcgroups:
    menu: >
      (
          $domain := '';
          $domain_matcher := $eval('/^' & $domain & '.*/');
      
          $vdcs_entity := "seaf.ta.reverse.general".config.entities.vdcs.model;
          $dcs_entity := "seaf.ta.reverse.general".config.entities.dc.model;
          $orgs_entity := "seaf.ta.reverse.general".config.entities.orgs.model;
          $vdcgroups_entity := "seaf.ta.reverse.general".config.entities.vdcgroups.model;
          $vdcgroups_view := "seaf.ta.reverse.general".config.entities.vdcgroups.view;
      
          $dcs := $lookup($, $dcs_entity)[$domain_matcher($keys())];
          $vdcgroups := $lookup($, $vdcgroups_entity)[$domain_matcher($keys())];
          $orgs := $lookup($, $orgs_entity)[$domain_matcher($keys())];
      
          $config := "seaf.ta.reverse.general".config;
          $lists := [$orgs.$spread().(
              $dcid := $.*.DC;
              $dcname := $dcs.$spread()[$keys() = $dcid].*.title;
              {
                  'location': $config.arch_menu & '/' & $dcname & '/Облако VMware/Реестры/VDC Groups',
                  'link': 'entities/' & $vdcgroups_view & '/list?domain=' & $domain
              }
          )];
          /*$static := [
              {
                  'location': $config.arch_menu & '/Cloud.ru/Облако VMware/Реестры/VDC Groups',
                  'link': 'entities/' & $vdcgroups_view & '/list?domain=' & $domain
              }];*/
          $dynamic := $vdcgroups.$spread().(
                $id := $keys()[0];
                $name := $.*.name;
                $org_id := $.*.org_id;
                $org := $orgs.$spread()[$keys() = $org_id];
                $orgname := $org.*.name;
                $dc := $dcs.$spread()[$keys() = $org.*.DC];
                {
                    'location': $config.arch_menu & '/' & $dc.*.title & '/Облако VMware/Организации/' & $orgname & '/' & $name,
                    'link': 'entities/' & $vdcgroups_view & '/card?id=' & $id
                }
          );
          $append($static, $dynamic)
      )
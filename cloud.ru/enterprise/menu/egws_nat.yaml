entities:
  seaf.ta.reverse.cloud_ru.enterprise.egws_nat:
    menu: >
      (
          $domain := '';
          $egws_entity_matcher := /.*\.enterprise\.egws$/;
          $orgs_entity_matcher := /.*\.enterprise\.orgs$/;
          $vdcs_entity_matcher := /.*\.enterprise\.vdcs$/;
          $vdcgroups_entity_matcher := /.*\.enterprise\.vdcgroups$/;
          $egws_nat_entity_matcher := /.*\.enterprise\.egws_nat$/;
          $dcs_entity_matcher := /.*\.services\.dc$/;
          $dcs_entity := $$.entities.$spread()[$dcs_entity_matcher($keys())].$keys()[0];
          $dcs := $$.$spread()[$dcs_entity_matcher($keys())].*;
          $vdcgroups_entity := $$.entities.$spread()[$vdcgroups_entity_matcher($keys())].$keys()[0];
          $vdcgroups := $$.$spread()[$vdcgroups_entity_matcher($keys())].*;
          $egws_entity := $$.entities.$spread()[$egws_entity_matcher($keys())].$keys()[0];
          $egws := $$.$spread()[$egws_entity_matcher($keys())].*;
          $vdcs_entity := $$.entities.$spread()[$vdcs_entity_matcher($keys())].$keys()[0];
          $vdcs := $$.$spread()[$vdcs_entity_matcher($keys())].*;
          $orgs_entity := $$.entities.$spread()[$orgs_entity_matcher($keys())].$keys()[0];
          $orgs := $$.$spread()[$orgs_entity_matcher($keys())].*;
          $egws_nat_entity := $$.entities.$spread()[$egws_nat_entity_matcher($keys())].$keys()[0];
          $egws_nat := $$.$spread()[$egws_nat_entity_matcher($keys())].*;
          $config := entities."seaf.ta.reverse.general".config;
          $dynamic := [$egws_nat.$spread().(
              $id := $keys()[0];
              $gw_id := $.*.gw_id;
              $egw := $egws.$spread()[$keys() = $gw_id];
              $egwname := $egw.*.name;
              $egw.*.vdcgroup_id != null ? (
                $vdcgroupname := $egw.*.vdcgroup_name;
                $vdcgroup_id := $egw.*.vdcgroup_id;
                $org_id := $egw.*.org_id;
                $org := $orgs.$spread()[$keys() = $org_id];
                $orgname := $org.*.name;
                $dc := $dcs.$spread()[$keys() = $org.*.DC];
                {
                    'location': $config.arch_menu & '/Провайдеры/' & $dc.*.dc_name & '/Enterprise/Организации/'  & $orgname & '/' & $vdcgroupname & '/Edge Gateways/' & $egwname & '/' & $.*.type & '/' & $.*.name,
                    'link': 'entities/' & $egws_nat_entity & '/' & $lowercase($.*.type) & '_schema?id=' & $id
                }
              ) : (
                $vdcname := $egw.*.vdc_name;
                $vdc_id := $egw.*.vdc_id;
                $org_id := $egw.*.org_id;
                $org := $orgs.$spread()[$keys() = $org_id];
                $orgname := $org.*.name;
                $dc := $dcs.$spread()[$keys() = $org.*.DC];
                {
                    'location': $config.arch_menu & '/Провайдеры/' & $dc.*.dc_name & '/Enterprise/Организации/' & $orgname & '/' & $vdcname & '/Edge Gateways/' & $egwname & '/' & $.*.type & '/' & $.*.name,
                    'link': 'entities/' & $egws_nat_entity & '/' & $lowercase($.*.type) & '_schema?id=' & $id
                }
              )
          )]
      )
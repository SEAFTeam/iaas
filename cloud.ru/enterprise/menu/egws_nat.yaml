entities:
  seaf.ta.reverse.vmwarecloud.egws_nat:
    menu: >
      (
          $domain := '';
          $domain_matcher := $eval('/^' & $domain & '.*/');
          $egws_entity := "seaf.ta.reverse.general".config.entities.egws.model;
          $egws_view := "seaf.ta.reverse.general".config.entities.egws.view;
          $egws_nat_entity := "seaf.ta.reverse.general".config.entities.egws_nat.model;
          $egws_nat_view := "seaf.ta.reverse.general".config.entities.egws_nat.view;
          $vdcs_entity := "seaf.ta.reverse.general".config.entities.vdcs.model;
          $dcs_entity := "seaf.ta.reverse.general".config.entities.dc.model;
          $orgs_entity := "seaf.ta.reverse.general".config.entities.orgs.model;
          $vdcgroups_entity := "seaf.ta.reverse.general".config.entities.vdcgroups.model;
          $egws := $lookup($, $egws_entity)[$domain_matcher($keys())];
          $egws_nat := $lookup($, $egws_nat_entity)[$domain_matcher($keys())];
          $dcs := $lookup($, $dcs_entity)[$domain_matcher($keys())];
          $vdcs := $lookup($, $vdcs_entity)[$domain_matcher($keys())];
          $vdcgroups := $lookup($, $vdcgroups_entity)[$domain_matcher($keys())];
          $orgs := $lookup($, $orgs_entity)[$domain_matcher($keys())];
          $config := "seaf.ta.reverse.general".config;
          $dynamic := [$egws_nat.$spread().(
              $id := $keys()[0];
              $gw_id := $.*.gw_id;
              $egw := $egws.$spread()[$keys() = $gw_id];
              $egwname := $egw.*.name;
              $egw.*.vdcgroup_id != null ? (
                $vdcgroupname := $egw.*.vdcgroup_name;
                $vdcgroup_id := $egw.*.vdcgroup_id;
                $org_id := $egw.*.org_id;
                $org := $orgs.$spread()[$keys() = $org_id];
                $orgname := $org.*.name;
                $dc := $dcs.$spread()[$keys() = $org.*.DC];
                {
                    'location': $config.arch_menu & '/' & $dc.*.title & '/VMware Cloud/Организации/'  & $orgname & '/' & $vdcgroupname & '/Edge Gateways/' & $egwname & '/' & $.*.type & '/' & $.*.name,
                    'link': 'entities/' & $egws_nat_entity & '/' & $lowercase($.*.type) & '_schema?id=' & $id
                }
              ) : (
                $vdcname := $egw.*.vdc_name;
                $vdc_id := $egw.*.vdc_id;
                $org_id := $egw.*.org_id;
                $org := $orgs.$spread()[$keys() = $org_id];
                $orgname := $org.*.name;
                $dc := $dcs.$spread()[$keys() = $org.*.DC];
                {
                    'location': $config.arch_menu & '/' & $dc.*.title & '/VMware Cloud/Организации/' & $orgname & '/' & $vdcname & '/Edge Gateways/' & $egwname & '/' & $.*.type & '/' & $.*.name,
                    'link': 'entities/' & $egws_nat_entity & '/' & $lowercase($.*.type) & '_schema?id=' & $id
                }
              )
          )]
      )